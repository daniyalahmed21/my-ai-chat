<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AI Chat Assistant</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 20px;
		}

		.chat-container {
			background: white;
			border-radius: 16px;
			box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
			width: 100%;
			max-width: 800px;
			height: 600px;
			display: flex;
			flex-direction: column;
			overflow: hidden;
		}

		.chat-header {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 20px;
			text-align: center;
			font-size: 24px;
			font-weight: 600;
			letter-spacing: 0.5px;
		}

		.chat-messages {
			flex: 1;
			padding: 20px;
			overflow-y: auto;
			display: flex;
			flex-direction: column;
			gap: 16px;
			background: #f8f9fa;
		}

		.message {
			display: flex;
			gap: 12px;
			animation: fadeIn 0.3s ease-in;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.message.user {
			flex-direction: row-reverse;
		}

		.message-avatar {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 600;
			color: white;
			flex-shrink: 0;
		}

		.message.user .message-avatar {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		}

		.message.assistant .message-avatar {
			background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
		}

		.message-content {
			max-width: 70%;
			padding: 12px 16px;
			border-radius: 12px;
			line-height: 1.5;
			word-wrap: break-word;
		}

		.message.user .message-content {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
		}

		.message.assistant .message-content {
			background: white;
			color: #333;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.chat-input-container {
			padding: 20px;
			background: white;
			border-top: 1px solid #e0e0e0;
			display: flex;
			gap: 12px;
		}

		.chat-input {
			flex: 1;
			padding: 12px 16px;
			border: 2px solid #e0e0e0;
			border-radius: 24px;
			font-size: 16px;
			outline: none;
			transition: border-color 0.3s;
		}

		.chat-input:focus {
			border-color: #667eea;
		}

		.send-button {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			border: none;
			padding: 12px 28px;
			border-radius: 24px;
			font-size: 16px;
			font-weight: 600;
			cursor: pointer;
			transition: transform 0.2s, box-shadow 0.2s;
		}

		.send-button:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
		}

		.send-button:active {
			transform: translateY(0);
		}

		.send-button:disabled {
			opacity: 0.6;
			cursor: not-allowed;
			transform: none;
		}

		.typing-indicator {
			display: flex;
			gap: 4px;
			padding: 12px 16px;
		}

		.typing-dot {
			width: 8px;
			height: 8px;
			border-radius: 50%;
			background: #999;
			animation: typing 1.4s infinite;
		}

		.typing-dot:nth-child(2) {
			animation-delay: 0.2s;
		}

		.typing-dot:nth-child(3) {
			animation-delay: 0.4s;
		}

		@keyframes typing {
			0%, 60%, 100% {
				transform: translateY(0);
			}
			30% {
				transform: translateY(-10px);
			}
		}

		.error-message {
			background: #ff4444;
			color: white;
			padding: 12px;
			border-radius: 8px;
			text-align: center;
			margin: 0 20px;
		}

		.chat-messages::-webkit-scrollbar {
			width: 8px;
		}

		.chat-messages::-webkit-scrollbar-track {
			background: #f1f1f1;
		}

		.chat-messages::-webkit-scrollbar-thumb {
			background: #667eea;
			border-radius: 4px;
		}

		.chat-messages::-webkit-scrollbar-thumb:hover {
			background: #764ba2;
		}

		@media (max-width: 768px) {
			.chat-container {
				height: 100vh;
				max-width: 100%;
				border-radius: 0;
			}

			.message-content {
				max-width: 80%;
			}
		}
	</style>
</head>
<body>
	<div class="chat-container">
		<div class="chat-header">
			AI Chat Assistant
		</div>
		<div class="chat-messages" id="chatMessages">
			<div class="message assistant">
				<div class="message-avatar">AI</div>
				<div class="message-content">
					Hello! I'm your AI assistant. How can I help you today?
				</div>
			</div>
		</div>
		<div class="chat-input-container">
			<input
				type="text"
				class="chat-input"
				id="chatInput"
				placeholder="Type your message..."
				autocomplete="off"
			>
			<button class="send-button" id="sendButton">Send</button>
		</div>
	</div>

	<script>
		const chatMessages = document.getElementById('chatMessages');
		const chatInput = document.getElementById('chatInput');
		const sendButton = document.getElementById('sendButton');

		const API_URL = window.location.origin;
		const USER_ID = 'user-' + Math.random().toString(36).substr(2, 9);

		let isProcessing = false;

		function addMessage(content, isUser = false) {
			const messageDiv = document.createElement('div');
			messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;

			const avatar = document.createElement('div');
			avatar.className = 'message-avatar';
			avatar.textContent = isUser ? 'You' : 'AI';

			const messageContent = document.createElement('div');
			messageContent.className = 'message-content';
			messageContent.textContent = content;

			messageDiv.appendChild(avatar);
			messageDiv.appendChild(messageContent);
			chatMessages.appendChild(messageDiv);

			chatMessages.scrollTop = chatMessages.scrollHeight;

			return messageContent;
		}

		function showTypingIndicator() {
			const messageDiv = document.createElement('div');
			messageDiv.className = 'message assistant';
			messageDiv.id = 'typingIndicator';

			const avatar = document.createElement('div');
			avatar.className = 'message-avatar';
			avatar.textContent = 'AI';

			const typingDiv = document.createElement('div');
			typingDiv.className = 'message-content typing-indicator';
			typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';

			messageDiv.appendChild(avatar);
			messageDiv.appendChild(typingDiv);
			chatMessages.appendChild(messageDiv);
			chatMessages.scrollTop = chatMessages.scrollHeight;
		}

		function removeTypingIndicator() {
			const indicator = document.getElementById('typingIndicator');
			if (indicator) {
				indicator.remove();
			}
		}

		function showError(message) {
			const errorDiv = document.createElement('div');
			errorDiv.className = 'error-message';
			errorDiv.textContent = message;
			chatMessages.appendChild(errorDiv);

			setTimeout(() => errorDiv.remove(), 5000);
		}

		async function sendMessage() {
			const message = chatInput.value.trim();

			if (!message || isProcessing) return;

			isProcessing = true;
			sendButton.disabled = true;
			chatInput.disabled = true;

			addMessage(message, true);
			chatInput.value = '';

			showTypingIndicator();

			try {
				const response = await fetch(`${API_URL}/chat`, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
						'x-user-id': USER_ID
					},
					body: JSON.stringify({ message })
				});

				removeTypingIndicator();

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const reader = response.body.getReader();
				const decoder = new TextDecoder();

				const messageContent = addMessage('', false);
				let fullText = '';

				while (true) {
					const { done, value } = await reader.read();

					if (done) break;

					const chunk = decoder.decode(value, { stream: true });
					fullText += chunk;
					messageContent.textContent = fullText;
					chatMessages.scrollTop = chatMessages.scrollHeight;
				}

			} catch (error) {
				removeTypingIndicator();
				console.error('Error:', error);
				showError('Failed to send message. Please try again.');
			} finally {
				isProcessing = false;
				sendButton.disabled = false;
				chatInput.disabled = false;
				chatInput.focus();
			}
		}

		sendButton.addEventListener('click', sendMessage);

		chatInput.addEventListener('keypress', (e) => {
			if (e.key === 'Enter' && !e.shiftKey) {
				e.preventDefault();
				sendMessage();
			}
		});

		chatInput.focus();
	</script>
</body>
</html>
